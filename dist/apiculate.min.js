/*! apiculate - v0.2.0 - 2013-12-18
* http://acreeser.github.io/apiculate/
* Copyright (c) 2013 ; Licensed MIT */
function MainCtrl(a){window.apiculate||(window.apiculate={}),window.apiculate.hosts||(window.apiculate.hosts={local:"localhost","default":"localhost:1234"}),a.endpoints=window.apiculate.endpoints?window.apiculate.endpoints:[{url:"/index.html",method:"GET",description:"Fetches the HTML view of apiculate",host:"local"},{url:"/js/apiculate.js",method:"GET",description:"Fetches the JS controller for apiculate",host:"local"},{url:"/css/apiculate.css",method:"GET",description:"Fetches the CSS of apiculate's view",host:"local"}],angular.forEach(a.endpoints,function(a){a.viewUrl=a.url,a.searchField=(a.url+" "+a.method+" "+a.description).toLowerCase(),a.pathParams=[],angular.forEach(a.paths,function(b,c){b.key=c,a.pathParams.push(b)}),angular.forEach(a.params,function(a){null!=a.apiDefault&&(a.hasDefault=!0),a.example||(a.example=a.apiDefault)})}),a.filter=function(b){if(void 0!=a.tokenFilter&&b.token!==a.tokenFilter)return!1;if(void 0!=a.authFilter&&b.auth!==a.authFilter)return!1;if(a.query){if("all"!=a.methodFilter&&b.method.toLowerCase()!=a.methodFilter)return!1;var c=a.query.toLowerCase();return-1!=b.searchField.toLowerCase().indexOf(c)}return"all"!=a.methodFilter?b.method.toLowerCase()==a.methodFilter:!0},a.hideAll=function(b){angular.forEach(a.endpoints,function(a){a.hide=b})},a.methodFilter="all"}var apiculate=angular.module("apiculate",[]);apiculate.directive("endpoint",["$http",function(a){return{scope:{endpoint:"=endpoint"},link:function(a){a.call=function(){a.endpoint.calling=!0,a.endpoint.callUrl="local"==a.endpoint.host?a.endpoint.viewUrl:window.apiculate.hosts[a.endpoint.host]+a.endpoint.viewUrl;var b=!1;angular.forEach(a.endpoint.params,function(c){null!=c.example?c.example!=c.apiDefault&&(b?a.endpoint.callUrl+="&":(a.endpoint.callUrl+="?",b=!0),a.endpoint.callUrl+=c.key+"="+c.example):c.optional&&(a.endpoint.callUrl="")}),a.endpoint.rawStatus=null,a.endpoint.raw&&a.getRaw()}},controller:function(b){b.paramFilter=function(a){return a.optional?a.example!=a.apiDefault:null!=a.apiDefault&&null==a.example?a.apiDefault:a.example},b.refreshUrl=function(){var a=b.endpoint.paths,c=b.endpoint.url;a&&angular.forEach(a,function(a,b){var d=a.example;d&&(-1!=c.indexOf("<<"+b+">>")?c=c.replace("<<"+b+">>",d):-1!=c.indexOf(":"+b)&&(c=c.replace(":"+b,d)))}),b.endpoint.viewUrl=c},b.getRaw=function(){a.defaults.useXDomain=!0,a({method:"GET",url:b.endpoint.callUrl}).success(function(a,c){b.endpoint.rawResponse=a,b.endpoint.rawStatus=c,b.endpoint.rawError=!1}).error(function(a,c){b.endpoint.rawResponse="",b.endpoint.rawError=a,b.endpoint.rawStatus=c}),a.defaults.useXDomain=!1},b.$watch("endpoint.raw",function(a){a&&b.getRaw()})}}}]);